Configuraci√≥n del servidor Web (w1)
  config.vm.define "web" do |web|
    web.vm.hostname = "w1.example.test"
    web.vm.network "private_network", ip: "192.168.57.11"

    web.vm.provision "shell", inline: <<-SHELL
      apt-get update && apt-get install -y nginx
      cat > /etc/nginx/sites-available/default <<EOL
server {
    listen 8080;
    listen [::]:8080;
    server_name w1;
    root /var/www/html;
    index index.html index.htm;
    location / {
        add_header Host w1.example.test;
        try_files $uri $uri/ =404;
    }
}
EOL
      systemctl restart nginx
      mkdir -p /var/www/html
      cat > /var/www/html/index.html <<EOL
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>example.test</title>
</head>
<body>
    <h1>example.test</h1>
    <h2>Bienvenido</h2>
    <p>Servidor w1</p>
</body>
</html>
EOL
    SHELL
  end
end
Vagrant.configure("2") do |config|
  config.vm.box = "debian/bookworm64"
  config.vm.network "private_network", ip: "192.168.33.10"

  config.vm.provider "virtualbox" do |vb|
    vb.memory = "2048"
    vb.cpus = 2
  end

  config.vm.provision "shell", inline: <<-SHELL
    echo "Actualizando sistema..."
    apt-get update && apt-get upgrade -y

    echo "Instalando Node.js y npm..."
    apt-get install -y nodejs npm

    echo "Instalando PM2..."
    npm install -g pm2

    echo "Creando directorio de la aplicacion..."
    mkdir -p /home/vagrant/mi_proyecto
    cd /home/vagrant/mi_proyecto

    echo "Inicializando proyecto Node.js..."
    npm init -y

    echo "Instalando Express..."
    npm install express

    echo "Creando archivo app.js..."
    cat <<EOF > app.js
    const express = require("express");
    const app = express();
    const port = 3000;
    app.get("/", (req, res) => res.send("Hello World!"));
    app.listen(port, () => console.log(App running on port ${port}));
    EOF

    echo "Creando archivo ecosystem.config.js..."
    cat <<EOF > ecosystem.config.js
    module.exports = {
      apps: [{
        name: "mi_app",
        script: "app.js",
        instances: 0,
        exec_mode: "cluster"
      }]
    };
    EOF

    echo "Iniciando aplicacion con PM2..."
    pm2 start ecosystem.config.js
    pm2 save
    pm2 startup systemd --user

  SHELL
end
